<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Finalized block header, plus tree of authenticated non-finalized block headers."><title>smoldot::chain::blocks_tree - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-9bb858ba049f1f21.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="smoldot" data-themes="" data-resource-suffix="" data-rustdoc-version="1.72.1 (d5c2e9c34 2023-09-13)" data-channel="1.72.1" data-search-js="search-f6292fe389d70017.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ><script src="../../../static.files/storage-59fd9b8ccb335783.js"></script><script defer src="../../../static.files/main-0795b7d26be81095.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../../smoldot/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../../smoldot/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module blocks_tree</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">chain</a>::<wbr><a class="mod" href="#">blocks_tree</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/smoldot/chain/blocks_tree.rs.html#18-703">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Finalized block header, plus tree of authenticated non-finalized block headers.</p>
<p>This module provides the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> type. This type is a data structure
containing a valid tree of block headers, plus the state necessary to verify new blocks with
the intent to add them to that tree. Each block header additionally holds a user-chosen
opaque data.</p>
<p>The state in the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> consists of:</p>
<ul>
<li>One “latest finalized” block and various information about its ancestors, akin to a
<a href="../chain_information/struct.ChainInformation.html" title="struct smoldot::chain::chain_information::ChainInformation"><code>chain_information::ChainInformation</code></a>.</li>
<li>Zero or more blocks that descend from that latest finalized block.</li>
</ul>
<p>The latest finalized block is a block that is guaranteed to never be reverted. While it can
always be set to the genesis block of the chain, it is preferable, in order to reduce
memory utilization, to maintain it to a block that is as high as possible in the chain.</p>
<blockquote>
<p><strong>Note</strong>: While mechanisms such as GrandPa provide a network-wide way to designate a block
as final, the concept of GrandPa-provided finality doesn’t necessarily have to
match the concept of finality in the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a>. For example, an API
user might decide to optimistically assume that the block whose number is
<code>highest_block - 5</code> is automatically finalized, and fall back to rebuilding a new
<a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> if that assumption turns out to not be true. The finalized
block in the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> only represents a block that the
<a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> itself cannot remove, not a block that cannot be removed in
the absolute.</p>
</blockquote>
<p>A block can be added to the chain by calling <a href="struct.NonFinalizedTree.html#method.verify_header" title="method smoldot::chain::blocks_tree::NonFinalizedTree::verify_header"><code>NonFinalizedTree::verify_header</code></a> then
<a href="struct.NonFinalizedTree.html#method.insert_verified_header" title="method smoldot::chain::blocks_tree::NonFinalizedTree::insert_verified_header"><code>NonFinalizedTree::insert_verified_header</code></a>. As explained in details in
<a href="../../verify/index.html" title="mod smoldot::verify">the <code>verify</code> module</a>, verifying the header only verifies the authenticity of
a block and not its correctness. Additionally verifying the body of the block provides the
strongest guarantee, but is the responsibility of the API user and is out of the scope of
this module.</p>
<blockquote>
<p><strong>Note</strong>: There typically exists two kinds of clients: full and light. Full clients store
the state of the storage, while light clients don’t. For this reason, light
clients can only verify the header of new blocks. Both full and light clients
should wait for a block to be finalized if they want to be certain that it will
forever remain part of the chain.</p>
</blockquote>
<p>Additionally, a <a href="struct.NonFinalizedTree.html#method.verify_justification" title="method smoldot::chain::blocks_tree::NonFinalizedTree::verify_justification"><code>NonFinalizedTree::verify_justification</code></a> method is provided in order to
verify the correctness of a <a href="../../finality/justification/index.html" title="mod smoldot::finality::justification">justification</a>.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.BlockAccess.html" title="struct smoldot::chain::blocks_tree::BlockAccess">BlockAccess</a></div><div class="desc docblock-short">Access to a block’s information and hierarchy.</div></li><li><div class="item-name"><a class="struct" href="struct.Config.html" title="struct smoldot::chain::blocks_tree::Config">Config</a></div><div class="desc docblock-short">Configuration for the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.FinalityApply.html" title="struct smoldot::chain::blocks_tree::FinalityApply">FinalityApply</a></div><div class="desc docblock-short">Returned by <a href="struct.NonFinalizedTree.html#method.verify_justification" title="method smoldot::chain::blocks_tree::NonFinalizedTree::verify_justification"><code>NonFinalizedTree::verify_justification</code></a> and
<a href="struct.NonFinalizedTree.html#method.verify_grandpa_commit_message" title="method smoldot::chain::blocks_tree::NonFinalizedTree::verify_grandpa_commit_message"><code>NonFinalizedTree::verify_grandpa_commit_message</code></a> on success.</div></li><li><div class="item-name"><a class="struct" href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree">NonFinalizedTree</a></div><div class="desc docblock-short">Holds state about the current state of the chain for the purpose of verifying headers.</div></li><li><div class="item-name"><a class="struct" href="struct.RemovedBlock.html" title="struct smoldot::chain::blocks_tree::RemovedBlock">RemovedBlock</a></div><div class="desc docblock-short">Block removed from the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> by a <a href="struct.SetFinalizedBlockIter.html" title="struct smoldot::chain::blocks_tree::SetFinalizedBlockIter"><code>SetFinalizedBlockIter</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.SetFinalizedBlockIter.html" title="struct smoldot::chain::blocks_tree::SetFinalizedBlockIter">SetFinalizedBlockIter</a></div><div class="desc docblock-short">Iterator producing the newly-finalized blocks removed from the state when the finalized block
is updated.</div></li><li><div class="item-name"><a class="struct" href="struct.VerifiedHeader.html" title="struct smoldot::chain::blocks_tree::VerifiedHeader">VerifiedHeader</a></div><div class="desc docblock-short">Successfully-verified block header that can be inserted into the chain.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.CommitVerifyError.html" title="enum smoldot::chain::blocks_tree::CommitVerifyError">CommitVerifyError</a></div><div class="desc docblock-short">Error that can happen when verifying a Grandpa commit.</div></li><li><div class="item-name"><a class="enum" href="enum.FinalityVerifyError.html" title="enum smoldot::chain::blocks_tree::FinalityVerifyError">FinalityVerifyError</a></div><div class="desc docblock-short">Error that can happen when verifying a proof of finality.</div></li><li><div class="item-name"><a class="enum" href="enum.HeaderVerifyError.html" title="enum smoldot::chain::blocks_tree::HeaderVerifyError">HeaderVerifyError</a></div><div class="desc docblock-short">Error that can happen when verifying a block header.</div></li><li><div class="item-name"><a class="enum" href="enum.HeaderVerifySuccess.html" title="enum smoldot::chain::blocks_tree::HeaderVerifySuccess">HeaderVerifySuccess</a></div><div class="desc docblock-short">See <a href="struct.NonFinalizedTree.html#method.verify_header" title="method smoldot::chain::blocks_tree::NonFinalizedTree::verify_header"><code>NonFinalizedTree::verify_header</code></a>.</div></li><li><div class="item-name"><a class="enum" href="enum.JustificationVerifyError.html" title="enum smoldot::chain::blocks_tree::JustificationVerifyError">JustificationVerifyError</a></div><div class="desc docblock-short">Error that can happen when verifying a justification.</div></li><li><div class="item-name"><a class="enum" href="enum.RemovedBlockType.html" title="enum smoldot::chain::blocks_tree::RemovedBlockType">RemovedBlockType</a></div><div class="desc docblock-short">Reason why a block was removed from the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> by a <a href="struct.SetFinalizedBlockIter.html" title="struct smoldot::chain::blocks_tree::SetFinalizedBlockIter"><code>SetFinalizedBlockIter</code></a>.</div></li><li><div class="item-name"><a class="enum" href="enum.SetFinalizedError.html" title="enum smoldot::chain::blocks_tree::SetFinalizedError">SetFinalizedError</a></div><div class="desc docblock-short">Error that can happen when setting the finalized block.</div></li></ul></section></div></main></body></html>